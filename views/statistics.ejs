<!DOCTYPE html>
<html lang="en">
  <%- include('includes/header') %>
  <body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen flex flex-col">
    <%- include('includes/navbar') %>
    
    <main class="flex-grow animate-fadeIn">
      <div class="container mx-auto px-4 py-8 md:py-12">
        <div class="max-w-5xl mx-auto">
          <div class="text-center mb-10">
            <h1 class="text-3xl font-bold text-dark-800 mb-4 flex items-center justify-center md:text-4xl">
              <i class="fas fa-chart-bar text-primary-500 mr-3"></i>
              <span class="bg-clip-text text-transparent bg-gradient-to-r from-dark-800 to-dark-700 font-display">Statistics</span>
            </h1>
            <p class="text-lg text-dark-600 max-w-2xl mx-auto">
              Our database is constantly growing as we discover more magnets from the DHT swarm.
            </p>
          </div>
          
          <div class="bg-white rounded-xl shadow-elegant overflow-hidden transition-all duration-300 hover:shadow-elegant-lg transform border border-gray-100">
            <div class="p-6 md:p-8">
              <h2 class="text-2xl font-bold text-dark-900 mb-8 flex items-center">
                <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center mr-3 shadow-sm">
                  <i class="fas fa-database text-primary-600"></i>
                </div>
                <span>Database Statistics</span>
              </h2>
              
              <div class="grid gap-8 md:grid-cols-2">
                <div class="space-y-5">
                  <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 transition-all duration-200 hover:bg-gray-100 hover:scale-[1.02] transform shadow-sm">
                    <div class="text-dark-700 font-medium flex items-center">
                      <div class="w-8 h-8 bg-primary-500/10 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-server text-primary-600"></i>
                      </div>
                      <span>Database</span>
                    </div>
                    <span class="px-3 py-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-medium rounded-full shadow-sm" id="db"><%= statistics.db %></span>
                  </div>
                  
                  <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 transition-all duration-200 hover:bg-gray-100 hover:scale-[1.02] transform shadow-sm">
                    <div class="text-dark-700 font-medium flex items-center">
                      <div class="w-8 h-8 bg-primary-500/10 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-table text-primary-600"></i>
                      </div>
                      <span>Collections</span>
                    </div>
                    <span class="px-3 py-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-medium rounded-full shadow-sm" id="collections"><%= statistics.collections %></span>
                  </div>
                  
                  <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 transition-all duration-200 hover:bg-gray-100 hover:scale-[1.02] transform shadow-sm">
                    <div class="text-dark-700 font-medium flex items-center">
                      <div class="w-8 h-8 bg-primary-500/10 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-cubes text-primary-600"></i>
                      </div>
                      <span>Objects</span>
                    </div>
                    <span class="px-3 py-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-medium rounded-full shadow-sm" id="objects"><%= statistics.objects.toLocaleString() %></span>
                  </div>
                </div>
                
                <div class="space-y-5">
                  <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 transition-all duration-200 hover:bg-gray-100 hover:scale-[1.02] transform shadow-sm">
                    <div class="text-dark-700 font-medium flex items-center">
                      <div class="w-8 h-8 bg-primary-500/10 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-calculator text-primary-600"></i>
                      </div>
                      <span>Avg. Object Size</span>
                    </div>
                    <span class="px-3 py-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-medium rounded-full shadow-sm" id="avgObjSize"><%= statistics.avgObjSize %> KB</span>
                  </div>
                  
                  <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 transition-all duration-200 hover:bg-gray-100 hover:scale-[1.02] transform shadow-sm">
                    <div class="text-dark-700 font-medium flex items-center">
                      <div class="w-8 h-8 bg-primary-500/10 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-database text-primary-600"></i>
                      </div>
                      <span>Data Size</span>
                    </div>
                    <span class="px-3 py-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-medium rounded-full shadow-sm" id="dataSize"><%= statistics.dataSize %> MB</span>
                  </div>
                  
                  <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 transition-all duration-200 hover:bg-gray-100 hover:scale-[1.02] transform shadow-sm">
                    <div class="text-dark-700 font-medium flex items-center">
                      <div class="w-8 h-8 bg-primary-500/10 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-hdd text-primary-600"></i>
                      </div>
                      <span>Storage Size</span>
                    </div>
                    <span class="px-3 py-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-medium rounded-full shadow-sm" id="storageSize"><%= statistics.storageSize %> MB</span>
                  </div>
                  
                  <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 transition-all duration-200 hover:bg-gray-100 hover:scale-[1.02] transform shadow-sm">
                    <div class="text-dark-700 font-medium flex items-center">
                      <div class="w-8 h-8 bg-primary-500/10 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-sort-alpha-down text-primary-600"></i>
                      </div>
                      <span>Indexes</span>
                    </div>
                    <span class="px-3 py-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-medium rounded-full shadow-sm" id="indexes"><%= statistics.indexes %></span>
                  </div>
                  
                  <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 transition-all duration-200 hover:bg-gray-100 hover:scale-[1.02] transform shadow-sm">
                    <div class="text-dark-700 font-medium flex items-center">
                      <div class="w-8 h-8 bg-primary-500/10 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-weight-hanging text-primary-600"></i>
                      </div>
                      <span>Index Size</span>
                    </div>
                    <span class="px-3 py-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-medium rounded-full shadow-sm" id="indexSize"><%= statistics.indexSize %> MB</span>
                  </div>
                </div>
              </div>
              
              <div class="mt-10 p-5 bg-gray-50 rounded-lg border border-gray-200 shadow-inner">
                <div class="flex items-center justify-center text-dark-600">
                  <i class="fas fa-info-circle text-primary-500 mr-2"></i>
                  <span class="text-sm">Statistics are updated in real-time as new magnets are discovered.</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    
    <%- include('includes/footer') %>

    <script>
      // WebSocket connection for real-time updates
      let wsAddress = "<%= wsServerAddress %>";
      
      // Make sure WebSocket address has proper protocol
      if (!wsAddress.startsWith('ws')) {
        wsAddress = wsAddress.replace(/^http/, 'ws');
        if (!wsAddress.startsWith('ws')) {
          wsAddress = `ws://${wsAddress}`;
        }
      }
      
      console.log('Connecting to WebSocket server at:', wsAddress);
      const ws = new WebSocket(wsAddress);

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        
        // Handle statistics update
        if (data.eventType === 'statistics_update' && data.statistics) {
          updateStatistics(data.statistics);
        }
      };

      // Function to update statistics on the page
      function updateStatistics(stats) {
        if (!stats) return;
        
        // Update each statistic with animation
        updateStatWithAnimation('db', stats.db);
        updateStatWithAnimation('collections', stats.collections);
        updateStatWithAnimation('objects', parseInt(stats.objects).toLocaleString());
        updateStatWithAnimation('avgObjSize', stats.avgObjSize + ' KB');
        updateStatWithAnimation('dataSize', stats.dataSize + ' MB');
        updateStatWithAnimation('storageSize', stats.storageSize + ' MB');
        updateStatWithAnimation('indexes', stats.indexes);
        updateStatWithAnimation('indexSize', stats.indexSize + ' MB');
      }
      
      // Helper function to update a statistic with animation
      function updateStatWithAnimation(id, value) {
        const element = document.getElementById(id);
        if (!element) return;
        
        // Add pulse animation
        element.classList.add('scale-110');
        element.classList.add('bg-primary-500');
        
        // Update the value
        element.textContent = value;
        
        // Remove animation after a short delay
        setTimeout(() => {
          element.classList.remove('scale-110');
          element.classList.remove('bg-primary-500');
        }, 500);
      }
      
      ws.onopen = () => {
        console.log('WebSocket connection established.');
      };

      ws.onerror = (error) => {
        console.error('WebSocket Error:', error);
      };
      
      // Initial statistics values are already set in the HTML
    </script>
  </body>
</html> 